use std::{env, path::PathBuf};
use async_std::fs;
use crate::types::pixel::Pixel;

pub struct ModelHelper {}

impl ModelHelper {
    pub async fn load_msh_file() -> (Vec<Pixel>, usize) {
        // Open the .msh file generated by executing "gmsh mesh_script.geo" in the command line
        let mut pixels: Vec<Pixel> = vec![]; 
        let current_dir = env::current_dir().expect("Failed to get current directory");
        let relative_path = "mesh_output.msh";
        let mesh_file_path: PathBuf = current_dir.join("src").join("helpers").join("model_helper").join(relative_path);
        let msh_bytes = fs::read(mesh_file_path).await.unwrap();
        let parser_result = mshio::parse_msh_bytes(msh_bytes.as_slice());

        let mut count = 0;

        if let Some(nodes) = parser_result.unwrap().data.nodes {
            for node_blocks in nodes.node_blocks {
                for node in node_blocks.nodes {
                    let x = node.x as f32;
                    let y = node.y as f32;
                    let z = node.z as f32;

                    pixels.push(Pixel {
                        x,
                        y,
                        z,
                        r: 0.5,
                        g: 0.5,
                        b: 0.7,
                        a: 1.0,
                        size_factor: 1.7,
                    });

                    count += 1;
                }
            }
        }

        (pixels, count)
    }
}
